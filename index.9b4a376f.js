const t=new class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],e=0){this.initialState=structuredClone(t),this.state=structuredClone(t),this.score=e,this.status="idle",this.WINNING_VALUE=2048}moveLeft(){let t=!1;this.state.forEach((e,s)=>{let a=[...this.state[s]];this.state[s]=this.shift(e,"left"),this.arraysEqual(a,this.state[s])||(t=!0)}),t&&this.addRandomCell()}moveRight(){let t=!1;this.state.forEach((e,s)=>{let a=[...this.state[s]];this.state[s]=this.shift(e,"right"),this.arraysEqual(a,this.state[s])||(t=!0)}),t&&this.addRandomCell()}moveUp(){let t=this.state[0].length,e=this.state.length,s=!1;for(let a=0;a<t;a++){let t=this.state.map(t=>t[a]),l=this.state.map(t=>t[a]),i=this.shift(l,"up");this.arraysEqual(t,i)||(s=!0);for(let t=0;t<e;t++)this.state[t][a]=i[t]}s&&this.addRandomCell()}moveDown(){let t=this.state[0].length,e=this.state.length,s=!1;for(let a=0;a<t;a++){let t=this.state.map(t=>t[a]),l=this.state.map(t=>t[a]),i=this.shift(l,"down");this.arraysEqual(t,i)||(s=!0);for(let t=0;t<e;t++)this.state[t][a]=i[t]}s&&this.addRandomCell()}arraysEqual(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==e[s])return!1;return!0}getScore(){return this.score}getState(){return structuredClone(this.state)}getStatus(){return this.status}start(){this.addRandomCell(),this.addRandomCell(),this.getState(),this.status="playing"}restart(){this.state=JSON.parse(JSON.stringify(this.initialState)),this.score=0,this.status="idle"}addRandomCell(){let t=[];for(let e=0;e<this.state.length;e++)for(let s=0;s<this.state[e].length;s++)0===this.state[e][s]&&t.push([e,s]);if(0===t.length)return;let[e,s]=t[Math.floor(Math.random()*t.length)];this.state[e][s]=.1>Math.random()?4:2,this.updateHtmlCells()}getCells(){if(!this.cachedCells){let t=document.querySelectorAll(".field-row");this.cachedCells=Array.from(t).map(t=>Array.from(t.querySelectorAll(".field-cell")))}return this.cachedCells}updateHtmlCells(){let t=this.getCells();this.getState().forEach((e,s)=>{e.forEach((e,a)=>{let l=t[s][a];l.textContent=e||"",l.className=l.className.split(" ").filter(t=>!t.startsWith("field-cell--")).join(" "),0!==e&&l.classList.add(`field-cell--${e}`)})})}shift(t,e){let s=t.filter(t=>0!==t),a=[],l=0;for(let t=0;t<s.length;t++)if(s[t]===s[t+1]){let e=2*s[t];a.push(e),l+=e,t++}else a.push(s[t]);let i=Array(t.length-a.length).fill(0),r="left"===e||"up"===e?a.concat(i):i.concat(a);return this.score+=l,this.isGameOver(),this.isGameWin(),r}isGameOver(){for(let t of this.state)if(t.includes(0))return;let t=this.state.length,e=this.state[0].length;for(let s=0;s<t;s++)for(let a=0;a<e;a++){let l=this.state[s][a];if(a<e-1&&l===this.state[s][a+1]||s<t-1&&l===this.state[s+1][a])return}this.status="lose"}isGameWin(){this.getState().forEach(t=>{t.includes(this.WINNING_VALUE)&&(this.status="win")})}createTile(t,e){return{value:t,element:e}}setValue(t,e){t.value=e,t.element.textContent=0===e?"":e,t.element.className=t.element.className.split(" ").filter(t=>!t.startsWith("field-cell--")).join(" "),0!==e&&t.element.classList.add(`field-cell--${e}`)}setPosition(t,e,s){t.element.style.transition="transform 0.2s ease",t.element.style.transform=`translate(${100*e}px, ${100*s}px)`}animateTileAppear(t){t.element.classList.add("tile-appear")}},e=()=>{let e=document.querySelector(".start");e.addEventListener("click",()=>{t.start();let s=document.querySelector(".message-start"),a=document.querySelector(".restart");s&&s.classList.add("hidden"),a&&a.classList.remove("hidden"),e.classList.add("hidden")})},s=()=>{let e=document.querySelector(".restart");e.addEventListener("click",()=>{t.restart(),t.updateHtmlCells(),l();let s=document.querySelector(".message-start"),a=document.querySelector(".start"),i=document.querySelector(".message-lose"),r=document.querySelector(".message-win");s&&s.classList.remove("hidden"),a&&a.classList.remove("hidden"),e&&e.classList.add("hidden"),i&&i.classList.add("hidden"),r&&r.classList.add("hidden")})},a=()=>{document.addEventListener("keydown",e=>{if("playing"===t.getStatus()){switch(e.key){case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight();break;case"ArrowUp":t.moveUp();break;case"ArrowDown":t.moveDown();break;default:return}t.updateHtmlCells(),l(),i()}})},l=()=>{document.querySelector(".game-score").textContent=t.getScore()},i=()=>{let e=t.getStatus();"lose"===e?document.querySelector(".message-lose").classList.remove("hidden"):"win"===e&&document.querySelector(".message-win").classList.remove("hidden")};document.addEventListener("DOMContentLoaded",()=>{e(),s(),a()});
//# sourceMappingURL=index.9b4a376f.js.map
